<!DOCTYPE html>
<html>

<head>
	<title>Ping Pong Game</title>
</head>

<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

		app.onInit = function () {
			var paddleWidth = app.width / 40
			var paddleHeight = app.height / 4
			this.nodes.push({
				id: 'player-one',
				x: 0,
				y: (app.height - paddleHeight) / 2,
				width: paddleWidth,
				height: paddleHeight,
				speed: 3,
				color: 'black'

			});

			this.nodes.push({
				id: 'player-two',
				x: app.width - paddleWidth,
				y: (app.height - paddleHeight) / 2,
				width: paddleWidth,
				height: paddleHeight,
				speed: 3,
				color: 'black'
			});
			this.nodes.push({
				id: 'ball',
				x: app.width / 2,
				y: app.height / 2,
				width: 10,
				height: 10,
				speed: 5,
				radius: 3,
				xDir: 1,
				yDir: 1,
				color: 'red',


			});
			/**
			 * @param{KeyboardEvent} event
			 **/
			window.onkeydown = function (event) {
				switch (event.code) {
					case 'KeyW':

						app.getNode('player-one').y -= app.getNode('player-one').speed;

						if (app.getNode('player-one').y < 0) { app.getNode('player-one').y = 0 };
						break;
					case 'KeyS':

						app.getNode('player-one').y += app.getNode('player-one').speed;

						if (app.getNode('player-one').y + paddleHeight > app.height) { app.getNode('player-one').y = app.height - paddleHeight };
						break;
					case 'ArrowUp':
						app.getNode('player-two').y -= app.getNode('player-two').speed;

						if (app.getNode('player-two').y < 0) { app.getNode('player-two').y = 0 };
						break;
					case 'ArrowDown':
						app.getNode('player-two').y += app.getNode('player-two').speed;

						if (app.getNode('player-two').y + paddleHeight > app.height) { app.getNode('player-two').y = app.height - paddleHeight };
						break;
					case 'Space':
						break;
					default:
						console.log(event);
						break;
				}
			}
		};

		app.collisionCheck = function (ball) {
			var player1 = this.getNode('player-one');
			var player2 = this.getNode('player-two');
			//Player 1 collision
			if (ball.x < player1.x + player1.width &&
				ball.y < player1.y + (player1.height / 2)) {
				ball.yDir *= -1;
				ball.xDir *= -1;
			}
			else if (ball.x < player1.x + player1.width &&
				ball.y == player1.y + (player1.height / 2)) {
				ball.xDir *= -1;
			}
			//Player 2 collision
			if (ball.x + ball.width > player2.x &&
				ball.y < player2.y + (player2.height / 2)) {
				ball.xDir *= -1;
			}
			else if (ball.x + ball.width > player2.x &&
				ball.y == player2.y + (player2.height / 2)) {
				ball.yDir *= -1;
				ball.xDir *= -1;
			}
		}
		app.reset = function () { };
		app.pause = function () { };
		app.onUpdate = function (time) {
			var ball = this.getNode('ball');
			ball.y += Math.sin((Math.PI * (1 / 4)) * ball.speed) * ball.yDir;
			ball.x += Math.cos((Math.PI * (1 / 4)) * ball.speed) * ball.xDir;
			if (ball.y < 0 || ball.y + ball.height > app.height) {
				//console.log('Wall hit', this.getNode('ball').x, this.getNode('ball').y);
				ball.yDir *= -1;
			}

			if (ball.x < 0 || ball.x + ball.width > app.width) {
				//console.log('Wall hit', this.getNode('ball').x, this.getNode('ball').y);

				ball.xDir *= -1;
			}
			this.collisionCheck(ball)

		};
	</script>
</body>

</html>